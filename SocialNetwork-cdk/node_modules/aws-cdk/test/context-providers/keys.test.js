"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const AWS = require("aws-sdk-mock");
const keys_1 = require("../../lib/context-providers/keys");
const mock_sdk_1 = require("../util/mock-sdk");
AWS.setSDK(require.resolve('aws-sdk'));
const mockSDK = new mock_sdk_1.MockSdkProvider();
afterEach(done => {
    AWS.restore();
    done();
});
test('looks up the requested Key - single result', async () => {
    // GIVEN
    const provider = new keys_1.KeyContextProviderPlugin(mockSDK);
    AWS.mock('KMS', 'listAliases', (params, cb) => {
        expect(params.KeyId).toBeUndefined();
        return cb(null, {
            Aliases: [
                {
                    AliasName: 'alias/foo',
                    TargetKeyId: '1234abcd-12ab-34cd-56ef-123456789000',
                },
            ],
        });
    });
    // WHEN
    const result = await provider.getValue({
        account: '1234',
        region: 'us-east-1',
        aliasName: 'alias/foo',
    });
    // THEN
    expect(result).toEqual({
        keyId: '1234abcd-12ab-34cd-56ef-123456789000',
    });
});
test('looks up the requested Key - multiple results', async () => {
    // GIVEN
    const provider = new keys_1.KeyContextProviderPlugin(mockSDK);
    AWS.mock('KMS', 'listAliases', (params, cb) => {
        expect(params.KeyId).toBeUndefined();
        return cb(null, {
            Aliases: [
                {
                    AliasName: 'alias/bar',
                    TargetKeyId: '1234abcd-12ab-34cd-56ef-123456789000',
                },
                {
                    AliasName: 'alias/foo',
                    TargetKeyId: '1234abcd-12ab-34cd-56ef-123456789001',
                },
                {
                    AliasName: 'alias/fooBar',
                    TargetKeyId: '1234abcd-12ab-34cd-56ef-123456789002',
                },
            ],
        });
    });
    // WHEN
    const result = await provider.getValue({
        account: '1234',
        region: 'us-east-1',
        aliasName: 'alias/foo',
    });
    // THEN
    expect(result).toEqual({
        keyId: '1234abcd-12ab-34cd-56ef-123456789001',
    });
});
test('looks up the requested Key - multiple results with pagination', async () => {
    // GIVEN
    const provider = new keys_1.KeyContextProviderPlugin(mockSDK);
    AWS.mock('KMS', 'listAliases', (params, cb) => {
        if (!params.Marker) {
            return cb(null, {
                Truncated: true,
                NextMarker: 'nextMarker',
                Aliases: [
                    {
                        AliasName: 'alias/key1',
                        TargetKeyId: '1234abcd-12ab-34cd-56ef-123456789000',
                    },
                    {
                        AliasName: 'alias/key2',
                        TargetKeyId: '1234abcd-12ab-34cd-56ef-123456789001',
                    },
                    {
                        AliasName: 'alias/key3',
                        TargetKeyId: '1234abcd-12ab-34cd-56ef-123456789002',
                    },
                ],
            });
        }
        else if (params.Marker == 'nextMarker') {
            return cb(null, {
                Aliases: [
                    {
                        AliasName: 'alias/key4',
                        TargetKeyId: '1234abcd-12ab-34cd-56ef-123456789003',
                    },
                    {
                        AliasName: 'alias/foo',
                        TargetKeyId: '1234abcd-12ab-34cd-56ef-123456789004',
                    },
                    {
                        AliasName: 'alias/key5',
                        TargetKeyId: '1234abcd-12ab-34cd-56ef-123456789005',
                    },
                ],
            });
        }
    });
    // WHEN
    const result = await provider.getValue({
        account: '1234',
        region: 'us-east-1',
        aliasName: 'alias/foo',
    });
    // THEN
    expect(result).toEqual({
        keyId: '1234abcd-12ab-34cd-56ef-123456789004',
    });
});
test('throw exception - no key found', async () => {
    // GIVEN
    const provider = new keys_1.KeyContextProviderPlugin(mockSDK);
    AWS.mock('KMS', 'listAliases', (params, cb) => {
        expect(params.KeyId).toBeUndefined();
        return cb(null, {});
    });
    // WHEN
    await expect(provider.getValue({
        account: '1234',
        region: 'us-east-1',
        aliasName: 'alias/foo',
    })).rejects.toThrow(/Could not find any key with alias named/);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia2V5cy50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsia2V5cy50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBRUEsb0NBQW9DO0FBQ3BDLDJEQUE0RTtBQUM1RSwrQ0FBbUQ7QUFFbkQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7QUFDdkMsTUFBTSxPQUFPLEdBQUcsSUFBSSwwQkFBZSxFQUFFLENBQUM7QUFHdEMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFO0lBQ2YsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ2QsSUFBSSxFQUFFLENBQUM7QUFDVCxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyw0Q0FBNEMsRUFBRSxLQUFLLElBQUksRUFBRTtJQUM1RCxRQUFRO0lBQ1IsTUFBTSxRQUFRLEdBQUcsSUFBSSwrQkFBd0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUV2RCxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxhQUFhLEVBQUUsQ0FBQyxNQUFrQyxFQUFFLEVBQTRDLEVBQUUsRUFBRTtRQUNsSCxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3JDLE9BQU8sRUFBRSxDQUFDLElBQUksRUFBRTtZQUNkLE9BQU8sRUFBRTtnQkFDUDtvQkFDRSxTQUFTLEVBQUUsV0FBVztvQkFDdEIsV0FBVyxFQUFFLHNDQUFzQztpQkFDcEQ7YUFDRjtTQUNGLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsT0FBTztJQUNQLE1BQU0sTUFBTSxHQUFHLE1BQU0sUUFBUSxDQUFDLFFBQVEsQ0FBQztRQUNyQyxPQUFPLEVBQUUsTUFBTTtRQUNmLE1BQU0sRUFBRSxXQUFXO1FBQ25CLFNBQVMsRUFBRSxXQUFXO0tBQ3ZCLENBQUMsQ0FBQztJQUVILE9BQU87SUFDUCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDO1FBQ3JCLEtBQUssRUFBRSxzQ0FBc0M7S0FDOUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsK0NBQStDLEVBQUUsS0FBSyxJQUFJLEVBQUU7SUFDL0QsUUFBUTtJQUNSLE1BQU0sUUFBUSxHQUFHLElBQUksK0JBQXdCLENBQUMsT0FBTyxDQUFDLENBQUM7SUFFdkQsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsYUFBYSxFQUFFLENBQUMsTUFBa0MsRUFBRSxFQUE0QyxFQUFFLEVBQUU7UUFDbEgsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUNyQyxPQUFPLEVBQUUsQ0FBQyxJQUFJLEVBQUU7WUFDZCxPQUFPLEVBQUU7Z0JBQ1A7b0JBQ0UsU0FBUyxFQUFFLFdBQVc7b0JBQ3RCLFdBQVcsRUFBRSxzQ0FBc0M7aUJBQ3BEO2dCQUNEO29CQUNFLFNBQVMsRUFBRSxXQUFXO29CQUN0QixXQUFXLEVBQUUsc0NBQXNDO2lCQUNwRDtnQkFDRDtvQkFDRSxTQUFTLEVBQUUsY0FBYztvQkFDekIsV0FBVyxFQUFFLHNDQUFzQztpQkFDcEQ7YUFDRjtTQUNGLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsT0FBTztJQUNQLE1BQU0sTUFBTSxHQUFHLE1BQU0sUUFBUSxDQUFDLFFBQVEsQ0FBQztRQUNyQyxPQUFPLEVBQUUsTUFBTTtRQUNmLE1BQU0sRUFBRSxXQUFXO1FBQ25CLFNBQVMsRUFBRSxXQUFXO0tBQ3ZCLENBQUMsQ0FBQztJQUVILE9BQU87SUFDUCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDO1FBQ3JCLEtBQUssRUFBRSxzQ0FBc0M7S0FDOUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsK0RBQStELEVBQUUsS0FBSyxJQUFJLEVBQUU7SUFDL0UsUUFBUTtJQUNSLE1BQU0sUUFBUSxHQUFHLElBQUksK0JBQXdCLENBQUMsT0FBTyxDQUFDLENBQUM7SUFFdkQsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsYUFBYSxFQUFFLENBQUMsTUFBa0MsRUFBRSxFQUE0QyxFQUFFLEVBQUU7UUFDbEgsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUNuQixPQUFPLEVBQUUsQ0FBQyxJQUFJLEVBQUU7Z0JBQ2QsU0FBUyxFQUFFLElBQUk7Z0JBQ2YsVUFBVSxFQUFFLFlBQVk7Z0JBQ3hCLE9BQU8sRUFBRTtvQkFDUDt3QkFDRSxTQUFTLEVBQUUsWUFBWTt3QkFDdkIsV0FBVyxFQUFFLHNDQUFzQztxQkFDcEQ7b0JBQ0Q7d0JBQ0UsU0FBUyxFQUFFLFlBQVk7d0JBQ3ZCLFdBQVcsRUFBRSxzQ0FBc0M7cUJBQ3BEO29CQUNEO3dCQUNFLFNBQVMsRUFBRSxZQUFZO3dCQUN2QixXQUFXLEVBQUUsc0NBQXNDO3FCQUNwRDtpQkFDRjthQUNGLENBQUMsQ0FBQztRQUNMLENBQUM7YUFBTSxJQUFJLE1BQU0sQ0FBQyxNQUFNLElBQUksWUFBWSxFQUFFLENBQUM7WUFDekMsT0FBTyxFQUFFLENBQUMsSUFBSSxFQUFFO2dCQUNkLE9BQU8sRUFBRTtvQkFDUDt3QkFDRSxTQUFTLEVBQUUsWUFBWTt3QkFDdkIsV0FBVyxFQUFFLHNDQUFzQztxQkFDcEQ7b0JBQ0Q7d0JBQ0UsU0FBUyxFQUFFLFdBQVc7d0JBQ3RCLFdBQVcsRUFBRSxzQ0FBc0M7cUJBQ3BEO29CQUNEO3dCQUNFLFNBQVMsRUFBRSxZQUFZO3dCQUN2QixXQUFXLEVBQUUsc0NBQXNDO3FCQUNwRDtpQkFDRjthQUNGLENBQUMsQ0FBQztRQUNMLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVILE9BQU87SUFDUCxNQUFNLE1BQU0sR0FBRyxNQUFNLFFBQVEsQ0FBQyxRQUFRLENBQUM7UUFDckMsT0FBTyxFQUFFLE1BQU07UUFDZixNQUFNLEVBQUUsV0FBVztRQUNuQixTQUFTLEVBQUUsV0FBVztLQUN2QixDQUFDLENBQUM7SUFFSCxPQUFPO0lBQ1AsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQztRQUNyQixLQUFLLEVBQUUsc0NBQXNDO0tBQzlDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxDQUFDLGdDQUFnQyxFQUFFLEtBQUssSUFBSSxFQUFFO0lBQ2hELFFBQVE7SUFDUixNQUFNLFFBQVEsR0FBRyxJQUFJLCtCQUF3QixDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBRXZELEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLGFBQWEsRUFBRSxDQUFDLE1BQWtDLEVBQUUsRUFBNEMsRUFBRSxFQUFFO1FBQ2xILE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDckMsT0FBTyxFQUFFLENBQUMsSUFBSSxFQUFFLEVBQ2YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxPQUFPO0lBQ1AsTUFBTSxNQUFNLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQztRQUM3QixPQUFPLEVBQUUsTUFBTTtRQUNmLE1BQU0sRUFBRSxXQUFXO1FBQ25CLFNBQVMsRUFBRSxXQUFXO0tBQ3ZCLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMseUNBQXlDLENBQUMsQ0FBQztBQUVqRSxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIGltcG9ydC9vcmRlciAqL1xuaW1wb3J0ICogYXMgYXdzIGZyb20gJ2F3cy1zZGsnO1xuaW1wb3J0ICogYXMgQVdTIGZyb20gJ2F3cy1zZGstbW9jayc7XG5pbXBvcnQgeyBLZXlDb250ZXh0UHJvdmlkZXJQbHVnaW4gfSBmcm9tICcuLi8uLi9saWIvY29udGV4dC1wcm92aWRlcnMva2V5cyc7XG5pbXBvcnQgeyBNb2NrU2RrUHJvdmlkZXIgfSBmcm9tICcuLi91dGlsL21vY2stc2RrJztcblxuQVdTLnNldFNESyhyZXF1aXJlLnJlc29sdmUoJ2F3cy1zZGsnKSk7XG5jb25zdCBtb2NrU0RLID0gbmV3IE1vY2tTZGtQcm92aWRlcigpO1xudHlwZSBBd3NDYWxsYmFjazxUPiA9IChlcnI6IEVycm9yIHwgbnVsbCwgdmFsOiBUKSA9PiB2b2lkO1xuXG5hZnRlckVhY2goZG9uZSA9PiB7XG4gIEFXUy5yZXN0b3JlKCk7XG4gIGRvbmUoKTtcbn0pO1xuXG50ZXN0KCdsb29rcyB1cCB0aGUgcmVxdWVzdGVkIEtleSAtIHNpbmdsZSByZXN1bHQnLCBhc3luYyAoKSA9PiB7XG4gIC8vIEdJVkVOXG4gIGNvbnN0IHByb3ZpZGVyID0gbmV3IEtleUNvbnRleHRQcm92aWRlclBsdWdpbihtb2NrU0RLKTtcblxuICBBV1MubW9jaygnS01TJywgJ2xpc3RBbGlhc2VzJywgKHBhcmFtczogYXdzLktNUy5MaXN0QWxpYXNlc1JlcXVlc3QsIGNiOiBBd3NDYWxsYmFjazxhd3MuS01TLkxpc3RBbGlhc2VzUmVzcG9uc2U+KSA9PiB7XG4gICAgZXhwZWN0KHBhcmFtcy5LZXlJZCkudG9CZVVuZGVmaW5lZCgpO1xuICAgIHJldHVybiBjYihudWxsLCB7XG4gICAgICBBbGlhc2VzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBBbGlhc05hbWU6ICdhbGlhcy9mb28nLFxuICAgICAgICAgIFRhcmdldEtleUlkOiAnMTIzNGFiY2QtMTJhYi0zNGNkLTU2ZWYtMTIzNDU2Nzg5MDAwJyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vIFdIRU5cbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcHJvdmlkZXIuZ2V0VmFsdWUoe1xuICAgIGFjY291bnQ6ICcxMjM0JyxcbiAgICByZWdpb246ICd1cy1lYXN0LTEnLFxuICAgIGFsaWFzTmFtZTogJ2FsaWFzL2ZvbycsXG4gIH0pO1xuXG4gIC8vIFRIRU5cbiAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XG4gICAga2V5SWQ6ICcxMjM0YWJjZC0xMmFiLTM0Y2QtNTZlZi0xMjM0NTY3ODkwMDAnLFxuICB9KTtcbn0pO1xuXG50ZXN0KCdsb29rcyB1cCB0aGUgcmVxdWVzdGVkIEtleSAtIG11bHRpcGxlIHJlc3VsdHMnLCBhc3luYyAoKSA9PiB7XG4gIC8vIEdJVkVOXG4gIGNvbnN0IHByb3ZpZGVyID0gbmV3IEtleUNvbnRleHRQcm92aWRlclBsdWdpbihtb2NrU0RLKTtcblxuICBBV1MubW9jaygnS01TJywgJ2xpc3RBbGlhc2VzJywgKHBhcmFtczogYXdzLktNUy5MaXN0QWxpYXNlc1JlcXVlc3QsIGNiOiBBd3NDYWxsYmFjazxhd3MuS01TLkxpc3RBbGlhc2VzUmVzcG9uc2U+KSA9PiB7XG4gICAgZXhwZWN0KHBhcmFtcy5LZXlJZCkudG9CZVVuZGVmaW5lZCgpO1xuICAgIHJldHVybiBjYihudWxsLCB7XG4gICAgICBBbGlhc2VzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBBbGlhc05hbWU6ICdhbGlhcy9iYXInLFxuICAgICAgICAgIFRhcmdldEtleUlkOiAnMTIzNGFiY2QtMTJhYi0zNGNkLTU2ZWYtMTIzNDU2Nzg5MDAwJyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIEFsaWFzTmFtZTogJ2FsaWFzL2ZvbycsXG4gICAgICAgICAgVGFyZ2V0S2V5SWQ6ICcxMjM0YWJjZC0xMmFiLTM0Y2QtNTZlZi0xMjM0NTY3ODkwMDEnLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgQWxpYXNOYW1lOiAnYWxpYXMvZm9vQmFyJyxcbiAgICAgICAgICBUYXJnZXRLZXlJZDogJzEyMzRhYmNkLTEyYWItMzRjZC01NmVmLTEyMzQ1Njc4OTAwMicsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuICB9KTtcblxuICAvLyBXSEVOXG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHByb3ZpZGVyLmdldFZhbHVlKHtcbiAgICBhY2NvdW50OiAnMTIzNCcsXG4gICAgcmVnaW9uOiAndXMtZWFzdC0xJyxcbiAgICBhbGlhc05hbWU6ICdhbGlhcy9mb28nLFxuICB9KTtcblxuICAvLyBUSEVOXG4gIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgIGtleUlkOiAnMTIzNGFiY2QtMTJhYi0zNGNkLTU2ZWYtMTIzNDU2Nzg5MDAxJyxcbiAgfSk7XG59KTtcblxudGVzdCgnbG9va3MgdXAgdGhlIHJlcXVlc3RlZCBLZXkgLSBtdWx0aXBsZSByZXN1bHRzIHdpdGggcGFnaW5hdGlvbicsIGFzeW5jICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgY29uc3QgcHJvdmlkZXIgPSBuZXcgS2V5Q29udGV4dFByb3ZpZGVyUGx1Z2luKG1vY2tTREspO1xuXG4gIEFXUy5tb2NrKCdLTVMnLCAnbGlzdEFsaWFzZXMnLCAocGFyYW1zOiBhd3MuS01TLkxpc3RBbGlhc2VzUmVxdWVzdCwgY2I6IEF3c0NhbGxiYWNrPGF3cy5LTVMuTGlzdEFsaWFzZXNSZXNwb25zZT4pID0+IHtcbiAgICBpZiAoIXBhcmFtcy5NYXJrZXIpIHtcbiAgICAgIHJldHVybiBjYihudWxsLCB7XG4gICAgICAgIFRydW5jYXRlZDogdHJ1ZSxcbiAgICAgICAgTmV4dE1hcmtlcjogJ25leHRNYXJrZXInLFxuICAgICAgICBBbGlhc2VzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgQWxpYXNOYW1lOiAnYWxpYXMva2V5MScsXG4gICAgICAgICAgICBUYXJnZXRLZXlJZDogJzEyMzRhYmNkLTEyYWItMzRjZC01NmVmLTEyMzQ1Njc4OTAwMCcsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBBbGlhc05hbWU6ICdhbGlhcy9rZXkyJyxcbiAgICAgICAgICAgIFRhcmdldEtleUlkOiAnMTIzNGFiY2QtMTJhYi0zNGNkLTU2ZWYtMTIzNDU2Nzg5MDAxJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIEFsaWFzTmFtZTogJ2FsaWFzL2tleTMnLFxuICAgICAgICAgICAgVGFyZ2V0S2V5SWQ6ICcxMjM0YWJjZC0xMmFiLTM0Y2QtNTZlZi0xMjM0NTY3ODkwMDInLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKHBhcmFtcy5NYXJrZXIgPT0gJ25leHRNYXJrZXInKSB7XG4gICAgICByZXR1cm4gY2IobnVsbCwge1xuICAgICAgICBBbGlhc2VzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgQWxpYXNOYW1lOiAnYWxpYXMva2V5NCcsXG4gICAgICAgICAgICBUYXJnZXRLZXlJZDogJzEyMzRhYmNkLTEyYWItMzRjZC01NmVmLTEyMzQ1Njc4OTAwMycsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBBbGlhc05hbWU6ICdhbGlhcy9mb28nLFxuICAgICAgICAgICAgVGFyZ2V0S2V5SWQ6ICcxMjM0YWJjZC0xMmFiLTM0Y2QtNTZlZi0xMjM0NTY3ODkwMDQnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgQWxpYXNOYW1lOiAnYWxpYXMva2V5NScsXG4gICAgICAgICAgICBUYXJnZXRLZXlJZDogJzEyMzRhYmNkLTEyYWItMzRjZC01NmVmLTEyMzQ1Njc4OTAwNScsXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gV0hFTlxuICBjb25zdCByZXN1bHQgPSBhd2FpdCBwcm92aWRlci5nZXRWYWx1ZSh7XG4gICAgYWNjb3VudDogJzEyMzQnLFxuICAgIHJlZ2lvbjogJ3VzLWVhc3QtMScsXG4gICAgYWxpYXNOYW1lOiAnYWxpYXMvZm9vJyxcbiAgfSk7XG5cbiAgLy8gVEhFTlxuICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcbiAgICBrZXlJZDogJzEyMzRhYmNkLTEyYWItMzRjZC01NmVmLTEyMzQ1Njc4OTAwNCcsXG4gIH0pO1xufSk7XG5cbnRlc3QoJ3Rocm93IGV4Y2VwdGlvbiAtIG5vIGtleSBmb3VuZCcsIGFzeW5jICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgY29uc3QgcHJvdmlkZXIgPSBuZXcgS2V5Q29udGV4dFByb3ZpZGVyUGx1Z2luKG1vY2tTREspO1xuXG4gIEFXUy5tb2NrKCdLTVMnLCAnbGlzdEFsaWFzZXMnLCAocGFyYW1zOiBhd3MuS01TLkxpc3RBbGlhc2VzUmVxdWVzdCwgY2I6IEF3c0NhbGxiYWNrPGF3cy5LTVMuTGlzdEFsaWFzZXNSZXNwb25zZT4pID0+IHtcbiAgICBleHBlY3QocGFyYW1zLktleUlkKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgcmV0dXJuIGNiKG51bGwsIHtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8gV0hFTlxuICBhd2FpdCBleHBlY3QocHJvdmlkZXIuZ2V0VmFsdWUoe1xuICAgIGFjY291bnQ6ICcxMjM0JyxcbiAgICByZWdpb246ICd1cy1lYXN0LTEnLFxuICAgIGFsaWFzTmFtZTogJ2FsaWFzL2ZvbycsXG4gIH0pKS5yZWplY3RzLnRvVGhyb3coL0NvdWxkIG5vdCBmaW5kIGFueSBrZXkgd2l0aCBhbGlhcyBuYW1lZC8pO1xuXG59KTsiXX0=