"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.contentHashAny = exports.contentHash = void 0;
const crypto = require("crypto");
function contentHash(data) {
    return crypto.createHash('sha256').update(data).digest('hex');
}
exports.contentHash = contentHash;
/**
 * A stably sorted hash of an arbitrary JS object
 */
function contentHashAny(value) {
    const ret = crypto.createHash('sha256');
    recurse(value);
    return ret.digest('hex');
    function recurse(x) {
        if (typeof x === 'string') {
            ret.update(x);
            return;
        }
        if (Array.isArray(x)) {
            ret.update('[');
            for (const e of x) {
                recurse(e);
                ret.update('||');
            }
            ret.update(']');
            return;
        }
        if (x && typeof x === 'object') {
            ret.update('{');
            for (const key of Object.keys(x).sort()) {
                ret.update(key);
                ret.update(':');
                recurse(x[key]);
            }
            ret.update('}');
            return;
        }
        ret.update(`${x}${typeof x}`); // typeof to make sure hash('123') !== hash(123)
    }
}
exports.contentHashAny = contentHashAny;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udGVudC1oYXNoLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY29udGVudC1oYXNoLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLGlDQUFpQztBQUVqQyxTQUFnQixXQUFXLENBQUMsSUFBZ0M7SUFDMUQsT0FBTyxNQUFNLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDaEUsQ0FBQztBQUZELGtDQUVDO0FBRUQ7O0dBRUc7QUFDSCxTQUFnQixjQUFjLENBQUMsS0FBYztJQUMzQyxNQUFNLEdBQUcsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3hDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNmLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUV6QixTQUFTLE9BQU8sQ0FBQyxDQUFVO1FBQ3pCLElBQUksT0FBTyxDQUFDLEtBQUssUUFBUSxFQUFFLENBQUM7WUFDMUIsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNkLE9BQU87UUFDVCxDQUFDO1FBRUQsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDckIsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNoQixLQUFLLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO2dCQUNsQixPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ1gsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNuQixDQUFDO1lBQ0QsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNoQixPQUFPO1FBQ1QsQ0FBQztRQUVELElBQUksQ0FBQyxJQUFJLE9BQU8sQ0FBQyxLQUFLLFFBQVEsRUFBRSxDQUFDO1lBQy9CLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDaEIsS0FBSyxNQUFNLEdBQUcsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUM7Z0JBQ3hDLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ2hCLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ2hCLE9BQU8sQ0FBRSxDQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUMzQixDQUFDO1lBQ0QsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNoQixPQUFPO1FBQ1QsQ0FBQztRQUVELEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsZ0RBQWdEO0lBQ2pGLENBQUM7QUFDSCxDQUFDO0FBbENELHdDQWtDQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGNyeXB0byBmcm9tICdjcnlwdG8nO1xuXG5leHBvcnQgZnVuY3Rpb24gY29udGVudEhhc2goZGF0YTogc3RyaW5nIHwgQnVmZmVyIHwgRGF0YVZpZXcpIHtcbiAgcmV0dXJuIGNyeXB0by5jcmVhdGVIYXNoKCdzaGEyNTYnKS51cGRhdGUoZGF0YSkuZGlnZXN0KCdoZXgnKTtcbn1cblxuLyoqXG4gKiBBIHN0YWJseSBzb3J0ZWQgaGFzaCBvZiBhbiBhcmJpdHJhcnkgSlMgb2JqZWN0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjb250ZW50SGFzaEFueSh2YWx1ZTogdW5rbm93bikge1xuICBjb25zdCByZXQgPSBjcnlwdG8uY3JlYXRlSGFzaCgnc2hhMjU2Jyk7XG4gIHJlY3Vyc2UodmFsdWUpO1xuICByZXR1cm4gcmV0LmRpZ2VzdCgnaGV4Jyk7XG5cbiAgZnVuY3Rpb24gcmVjdXJzZSh4OiB1bmtub3duKSB7XG4gICAgaWYgKHR5cGVvZiB4ID09PSAnc3RyaW5nJykge1xuICAgICAgcmV0LnVwZGF0ZSh4KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoQXJyYXkuaXNBcnJheSh4KSkge1xuICAgICAgcmV0LnVwZGF0ZSgnWycpO1xuICAgICAgZm9yIChjb25zdCBlIG9mIHgpIHtcbiAgICAgICAgcmVjdXJzZShlKTtcbiAgICAgICAgcmV0LnVwZGF0ZSgnfHwnKTtcbiAgICAgIH1cbiAgICAgIHJldC51cGRhdGUoJ10nKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoeCAmJiB0eXBlb2YgeCA9PT0gJ29iamVjdCcpIHtcbiAgICAgIHJldC51cGRhdGUoJ3snKTtcbiAgICAgIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKHgpLnNvcnQoKSkge1xuICAgICAgICByZXQudXBkYXRlKGtleSk7XG4gICAgICAgIHJldC51cGRhdGUoJzonKTtcbiAgICAgICAgcmVjdXJzZSgoeCBhcyBhbnkpW2tleV0pO1xuICAgICAgfVxuICAgICAgcmV0LnVwZGF0ZSgnfScpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHJldC51cGRhdGUoYCR7eH0ke3R5cGVvZiB4fWApOyAvLyB0eXBlb2YgdG8gbWFrZSBzdXJlIGhhc2goJzEyMycpICE9PSBoYXNoKDEyMylcbiAgfVxufSJdfQ==